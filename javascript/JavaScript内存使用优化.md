## 1. 概述

首先要考虑一下该如何去精准测试```JavaScript```代码的性能，精准测试本质就是经过大量的数据采集，然后执行样本的数学统计分析，从而得出比对的结果来，证明什么样的脚本执行效率更高。

对编码者来说可能更多的只是关注该如何使用脚本去实现某一个功能，而不是去做大量的数学统计。这里采用基于```Benchmark.JavaScript```的一个```perf```网站，进行在线的```JavaScript```脚本的性能测试。

## 2. perf使用流程

1. 使用GitHub账号登录

2. 填写个人信息(非必须)

3. 填写详细的测试用例信息(title, slug)

这里比较关注的是测试用例的```title```和```slug```，会用它去生成一个短连接，用于去其他的地方访问测试用例。

4. 填写准备代码(DOM操作时经常使用)

5. 填写必要的setup和teardown代码

```setup```可以理解为是当前要做的前置准备，比如说要使用手机就要先打开手机，```teardown```就是所有代码执行完之后要做的销毁操作，比如使用数据库的时候，用完了应该把当前的链接资源释放掉让内存得到释放。

6. 填写测试代码片段

这里可以填一个片段也可以填多个片段，取决于想要测试几个片段，有了这些操作以后就可以直接在浏览器中运行脚本了。

最终当脚本在网站上执行完成之后就会给出数据上的体现，通过数据就可以得出，什么样类型的```JavaScript```脚本会具有更高的执行效率。可以在浏览器当中测试使用一下。

首先打开```JavaScriptperf```(```www.JavaScriptperf.com```)网站，登录完成之后，进入到填写个人信息界面，这里是非必填的，向下可以发现```Test case details```栏目。

这里有两个是必填的，一个是```title```，一个是```slug```，需要注意的是```slug```必须是唯一的，因为他会去生成一个空间，利于访问自己的测试用例。

往下看有个叫做```Preparation code html```栏目，这里就是准备代码，也就是需要用到一些```DOM```操作或者说需要引入一些第三方的资源库的时候，可以在这个里边贴那些代码。

在下边是```setup```和```teardown```的填写区域，可以在后续的测试中有所应用，现在不需要关心。

再往下就是当前代码片段的填写，这里有几个是必填的，第一个是测试标题，接着是要测试的代码片段，可以直接把代码贴在这里面，然后这里有多个片段，还可以自己添加。

准备好这些内容之后，可以直接保存，保存之后会跳转到新的界面。

## 3. 慎用全局变量

程序执行过程中如果针对某些数据需要进行存储，尽可能放置在局部作用域变成局部变量。在全局的范围内定义变量是存在全局的执行上下文中的，这个上下文是后续程序查找数据过程中所有作用域链的最顶端。按查找的过程来说，某些局部作用域没有找到的变量最终都会查找到顶端的全局作用域。这种情况下查找的时间消耗是非常大的，也降低了代码的执行效率。

除此以外全局上下文中定义的变量是存活于上下文执行栈的。上下文执行栈直到程序退出才会消失，这对GC工作是非常不利的，因为只要```GC```发现变量处于存活状态就不会把他当做垃圾对象进行回收。这样的做法会降低程序运行过程中内存的使用。

除此以外，如果某个局部作用域中定义了同名的变量，有可能造成变量的命名污染，将全局的数据进行了遮蔽。总归来说使用全局变量的时候需要考虑更多，否则就会带来意想不到的情况。

这里针对具体的场景来判断使用全局变量和使用局部变量的执行效率，二者进行对比。首先定义两个全局变量，```i```和```str```，```str```赋值个空的字符串。接下来通过```for```循环生成很长的字符串，这个字符串建议小一些，不然机器可能会出现问题。在循环内