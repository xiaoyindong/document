## 1. 概述

```WebRTC```是谷歌于```2011```年开源的一个音视频处理引擎，可以实时的进行视频数据的采集，也就是说可以做直播，也可以做```桌面录屏```，```桌面分享```。使用起来还是比较简单的。

## 2. 录屏工具开发

这里开发一个屏幕录制工具。首先在页面中创建一个```video```标签，用于展示录屏的内容，再创建四个按钮，一个```屏幕分享```，一个```开始录制```，一个```停止录制```，一个```下载视频```。

```html
<button id="start">屏幕分享</button>
<button id="record">开始录制</button>
<button id="stop">结束录制</button>
<button id="download">下载视频</button>
<video autoplay playsinline id="player"></video>
```

当点击屏幕分享按钮的时候，通过```getDisplayMedia```方法来获取桌面的媒体流，这里需要传入一个对象作为配置，对象中可以对```video```和```audio```进行设置，值可以是布尔类型也可以是对象类型，这里先设置布尔值，采集视频，不采集音频。

返回值是一个```Promise```，然后在```Promise```的```then```中将流媒体赋值给```video```标签的```srcObject```属性就可以了，非常的简单。

```js
document.querySelector('#start').onclick = function() {
    if (navigator.mediaDevices && navigator.mediaDevices.getDisplayMedia) {
        navigator.mediaDevices.getDisplayMedia({
            video: true,
            audio: false
        }).then((stream) => {
            document.querySelector('#player').srcObject = stream;
        }).catch((err) => {
            console.error(err);
        })
    } else {
        alert('不支持这个特性');
    }
}
```

当点击屏幕分享按钮时，浏览器会弹出选项询问录制哪部分内容，这里可以选择录制整个屏幕，或者是某个应用的界面，还可以是浏览器的指定标签页。

![](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f82455d31d244977ba74edb906b8709e~tplv-k3u1fbpfcp-watermark.image)

比如这里选择录制整个屏幕，此时video标签中就会显示我电脑屏幕中的内容了。

![](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6cf0c394fc4b4aa4918218b39c06641d~tplv-k3u1fbpfcp-watermark.image)

使用```getDisplayMedia```是可以将屏幕内容采集到的，如果想要将内容录制下来并且下载到本地需求使用WebRTC提供的另外一个类```MediaRecorder```。

他有很多的事件和方法。使用也非常简单。直接实例化就可以了。需要传入两个参数，第一个是```stream```，也就是通过```getDisplayMedia```拿到的媒体流，第二个是可